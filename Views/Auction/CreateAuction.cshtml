@model BTL_LTWNC.Models.TblAuction
@{
    ViewData["Title"] = "Tạo Đấu Giá";
    var product = ViewBag.Product as BTL_LTWNC.Models.TblProduct;
}

<link rel="stylesheet" href="~/css/Home/auction-create.css" asp-append-version="true" />

<div class="auction-container">

    <!-- HEADER -->
    <div class="auction-header">
        <h2>Tạo Đấu Giá Mới</h2>
        <a href="javascript:history.back()" class="btn-back">← Quay lại</a>
    </div>

    <!-- PRODUCT PREVIEW -->
    @if (product != null)
    {
        <div class="product-preview">
            <img src="@product.SImageUrl" alt="@product.SProductName" />

            <div class="product-info">
                <h3>@product.SProductName</h3>
                <p>@product.SDescription</p>
                <span class="price">
                    Giá khởi điểm:
                    <strong>@((product.DStartingPrice ?? 0).ToString("N0")) VNĐ</strong>
                </span>
            </div>
        </div>
    }

    <!-- FORM -->
    <form asp-action="CreateAuction" method="post" class="auction-form">
        <input type="hidden" asp-for="IProductId" value="@product?.IProductId" />

        <!-- AUCTION INFO -->
        <div class="form-section">
            <h4>Thông tin cuộc đấu giá</h4>

            <div class="form-row">
                <div class="form-group">
                    <label>Thời gian bắt đầu *</label>
                    <input asp-for="DtStartTime" type="datetime-local" required />
                </div>

                <div class="form-group">
                    <label>Thời gian kết thúc *</label>
                    <input asp-for="DtEndTime" type="datetime-local" required />
                </div>
            </div>

            <div class="form-group">
                <label>Trạng thái *</label>
                <select asp-for="SStatus" required>
                    <option value="">-- Chọn trạng thái --</option>
                    <option value="Sắp diễn ra">Sắp diễn ra</option>
                    <option value="Đang diễn ra">Đang diễn ra</option>
                    <option value="Đã kết thúc">Đã kết thúc</option>
                </select>
            </div>
        </div>

        <!-- BID INFO -->
        <div class="form-section">
            <h4>Thông tin đấu giá</h4>

            <div class="form-row">
                <div class="form-group">
                    <label>Mã sản phẩm</label>
                    <input type="text" value="@product?.IProductId" disabled />
                </div>

                <div class="form-group">
                    <label>Giá cao nhất hiện tại</label>
                    <input asp-for="DHighestBid" type="number" placeholder="0" />
                    <small>Để trống nếu chưa có lượt đấu</small>
                </div>
            </div>
        </div>

        <!-- ACTIONS -->
        <div class="form-actions">
            <button type="submit" class="btn-primary">Gửi yêu cầu</button>
            <a href="javascript:history.back()" class="btn-secondary">Hủy</a>
        </div>
    </form>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {

        const startTimeInput = document.querySelector('input[name="DtStartTime"]');
        const endTimeInput = document.querySelector('input[name="DtEndTime"]');

        if (!startTimeInput || !endTimeInput) return;

        // Lấy thời gian hiện tại
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const minDateTime = `${year}-${month}-${day}T${hours}:${minutes}`;

        // Set min cho start & end
        startTimeInput.min = minDateTime;
        endTimeInput.min = minDateTime;

        // Khi đổi thời gian bắt đầu
        startTimeInput.addEventListener('change', function () {
            endTimeInput.min = this.value;

            if (endTimeInput.value && endTimeInput.value <= this.value) {
                alert('Thời gian kết thúc phải sau thời gian bắt đầu!');
                endTimeInput.value = '';
            }
        });

        // Khi đổi thời gian kết thúc
        endTimeInput.addEventListener('change', function () {
            if (startTimeInput.value && this.value <= startTimeInput.value) {
                alert('Thời gian kết thúc phải sau thời gian bắt đầu!');
                this.value = '';
            }
        });
    });
</script>
